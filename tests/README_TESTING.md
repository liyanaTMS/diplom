# Задания по автоматизированному тестированию

## Общее описание

В рамках данных заданий вам предстоит разработать набор автоматизированных end-to-end тестов для веб-приложения "Менеджер задач". Тесты должны охватывать как серверную часть (backend API), так и пользовательский интерфейс (UI).

Цель заданий - научиться создавать надежные, поддерживаемые и информативные автоматизированные тесты, которые будут запускаться в системе непрерывной интеграции.

## Задание 1: End-to-End тестирование Backend API

### Цель
Разработать набор автоматизированных тестов для проверки функциональности REST API менеджера задач.

### Описание
API менеджера задач предоставляет следующие возможности:
- Регистрация и аутентификация пользователей
- Создание, чтение, обновление и удаление задач (CRUD)
- Изменение статуса задач (выполнено/не выполнено)

Ваша задача - разработать тесты, которые проверят корректность работы этих функций.

### Требования к тестам
1. Тесты должны быть написаны на Python с использованием pytest
2. Для выполнения HTTP-запросов следует использовать библиотеку requests
3. Тесты должны быть параметризованы с помощью Allure для возможности запуска с разными наборами данных
4. Каждый тест должен создавать подробный отчет в Allure с информацией о шагах, запросах и ответах
5. Тесты должны быть независимыми и изолированными друг от друга
6. После выполнения тестов все созданные тестовые данные должны быть удалены
7. Тесты должны проверять, что данные корректно сохраняются в базе данных PostgreSQL

### Сценарии для реализации

#### Сценарий 1: Полный жизненный цикл задачи
Реализуйте тест, который проверяет полный жизненный цикл задачи через API:
1. Регистрация нового пользователя (или использование существующего)
2. Аутентификация пользователя
3. Создание новой задачи
4. Получение созданной задачи по ID
5. Прямое подключение к базе данных PostgreSQL для проверки наличия записи
6. Проверка соответствия данных в базе данных отправленным через API
7. Обновление задачи (изменение названия, описания)
8. Изменение статуса задачи (выполнено/не выполнено)
9. Удаление задачи
10. Проверка, что задача успешно удалена

#### Сценарий 2: Проверка безопасности API
Реализуйте тест, который проверяет, что API правильно обрабатывает неавторизованные запросы:
1. Попытка доступа к защищенным эндпоинтам без авторизации
2. Проверка, что возвращается правильный код ошибки (401)
3. Проверка, что в ответе содержится корректное сообщение об ошибке авторизации

### Пример подключения к базе данных PostgreSQL

```python
import psycopg2

def test_database_connection():
    """Пример подключения к базе данных PostgreSQL и выполнения запроса"""
    # Параметры подключения
    db_params = {
        'dbname': 'taskmanager',
        'user': 'postgres',
        'password': 'postgres',
        'host': 'localhost',  # или IP-адрес сервера БД
        'port': '5432'
    }
    
    try:
        # Установка соединения
        conn = psycopg2.connect(**db_params)
        
        # Создание курсора
        cursor = conn.cursor()
        
        # Выполнение SQL-запроса
        cursor.execute("SELECT id, title, description, completed FROM task WHERE title = %s", ("Тестовая задача",))
        
        # Получение результатов
        task = cursor.fetchone()
        
        # Проверка результатов
        assert task is not None, "Задача не найдена в базе данных"
        task_id, title, description, completed = task
        assert title == "Тестовая задача"
        assert description == "Описание тестовой задачи"
        
        # Закрытие курсора и соединения
        cursor.close()
        conn.close()
        
    except Exception as e:
        print(f"Ошибка при работе с базой данных: {e}")
        raise
```

При запуске тестов в Docker-контейнере, необходимо учитывать сетевые настройки:

```python
# Для тестов, запускаемых внутри Docker-сети
db_params = {
    'dbname': 'taskmanager',
    'user': 'postgres',
    'password': 'postgres',
    'host': 'db',  # имя сервиса в docker-compose.yml
    'port': '5432'
}

# Для тестов, запускаемых на хост-машине
db_params = {
    'dbname': 'taskmanager',
    'user': 'postgres',
    'password': 'postgres',
    'host': 'localhost',  # или IP-адрес, на котором доступен контейнер
    'port': '5432'
}
```


## Задание 2: End-to-End тестирование пользовательского интерфейса

### Цель
Разработать набор автоматизированных тестов для проверки пользовательского интерфейса менеджера задач.

### Описание
Пользовательский интерфейс менеджера задач предоставляет следующие возможности:
- Регистрация и вход в систему
- Просмотр списка задач
- Создание новых задач
- Редактирование существующих задач
- Отметка задач как выполненных/невыполненных
- Удаление задач

Ваша задача - разработать тесты, которые проверят корректность работы этих функций через пользовательский интерфейс.

### Требования к тестам
1. Тесты должны быть написаны на Python с использованием pytest
2. Для автоматизации браузера следует использовать Selenium WebDriver/playwright
3. Тесты должны следовать паттерну Page Object Model для лучшей структуры и поддерживаемости
4. Тесты должны быть параметризованы с помощью Allure для возможности запуска с разными наборами данных
5. Каждый тест должен создавать подробный отчет в Allure с информацией о шагах и скриншотами
6. Тесты должны использовать стабильные селекторы (предпочтительно data-testid)
7. Тесты должны быть устойчивыми к изменениям в UI
8. Тесты должны выполняться в разных браузерах (Chrome и Firefox) для проверки кросс-браузерной совместимости

### Сценарии для реализации

#### Сценарий 1: Регистрация и аутентификация пользователя
Реализуйте тест, который проверяет процесс регистрации и входа в систему:
1. Генерация уникальных тестовых данных для пользователя
2. Переход на страницу регистрации
3. Заполнение формы регистрации и отправка
4. Проверка успешной регистрации (перенаправление, сообщение об успехе)
5. Переход на страницу входа
6. Ввод учетных данных и отправка формы
7. Проверка успешного входа (перенаправление на страницу задач, отображение имени пользователя)
8. Выход из системы
9. Проверка успешного выхода (перенаправление на страницу входа, сообщение)

#### Сценарий 2: Управление задачами
Реализуйте тест, который проверяет основные операции с задачами через UI:
1. Вход в систему (используя существующего пользователя)
2. Создание новой задачи (заполнение формы, отправка)
3. Проверка, что задача появилась в списке
4. Редактирование задачи (изменение названия, описания, статуса)
5. Проверка, что изменения сохранились
6. Отметка задачи как выполненной
7. Проверка, что статус изменился
8. Удаление задачи
9. Проверка, что задача исчезла из списка
10. Выполнение всех вышеперечисленных шагов в разных браузерах (Chrome и Firefox)

## Настройка CI/CD с Jenkins

### Цель
Настроить автоматический запуск тестов в Jenkins при коммите в GitHub.

### Требования
1. Создать Jenkinsfile с описанием pipeline для запуска тестов
2. Настроить запуск тестов в Docker-контейнере
3. Настроить генерацию отчетов Allure
4. Настроить уведомления о результатах тестирования

### Шаги для реализации
1. Создать Jenkinsfile в корне проекта
2. Описать этапы pipeline:
   - Клонирование репозитория
   - Настройка окружения (установка зависимостей)
   - Запуск приложения в Docker
   - Запуск API-тестов
   - Запуск UI-тестов
   - Генерация отчетов Allure
   - Остановка приложения
3. Настроить триггер на коммит в GitHub
4. Настроить сохранение отчетов Allure как артефактов сборки

## Критерии оценки

### Функциональность (40%)
- Все тесты успешно запускаются и проходят
- Тесты корректно проверяют заявленную функциональность
- Тесты обрабатывают как позитивные, так и негативные сценарии

### Качество кода (30%)
- Код соответствует стандартам PEP 8
- Используются паттерны автоматизации (Page Object Model для UI-тестов)
- Код содержит необходимые комментарии и документацию

### Отчетность (15%)
- Тесты создают подробные отчеты в Allure
- Отчеты содержат всю необходимую информацию (шаги, скриншоты, данные запросов/ответов)
- Отчеты позволяют быстро определить причину падения теста

### CI/CD интеграция (15%)
- Тесты успешно запускаются в Jenkins
- Pipeline корректно настроен и работает
- Настроены уведомления о результатах тестирования

## Дополнительные материалы

### Полезные ссылки
- [Документация pytest](https://docs.pytest.org/)
- [Документация Selenium WebDriver](https://www.selenium.dev/documentation/)
- [Документация Allure](https://docs.qameta.io/allure/)
- [Документация Jenkins Pipeline](https://www.jenkins.io/doc/book/pipeline/)

### Советы по выполнению
- Начните с простых тестов и постепенно усложняйте их
- Используйте фикстуры pytest для повторного использования кода
- Разделяйте тесты на небольшие, атомарные проверки
- Используйте явные ожидания в UI-тестах для повышения стабильности
- Тщательно документируйте шаги в Allure для облегчения отладки
